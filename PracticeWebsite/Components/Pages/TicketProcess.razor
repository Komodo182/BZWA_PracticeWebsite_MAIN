@page "/tickets/processing"
@rendermode InteractiveServer
@* @inject AttractionService AttractionService
@using PracticeWebsite.Models
@using PracticeWebsite.
 *@


<PageTitle>Ticket Purchasing...</PageTitle>
<MudContainer Fixed="true">
    <MudCard Class="flex-auto d-flex py-8 mud-theme-white" Elevation="6">
        <MudStepper NonLinear ShowResetButton OnPreviewInteraction="OnPreviewInteraction">

            <MudStep Title="Date" SecondaryText="When are you visiting?" HasError="@(_step1Complete==false)">
                @* <MudSwitch @bind-Value="_step1Complete" Color="Color.Primary">Flip the switch to be able to advance to step 2</MudSwitch> *@
                <MudCard>
                    <MudCardHeader>
                        <MudText Typo="Typo.h4">Please select what day you would like to book...</MudText>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudDatePicker @bind-Date="_datechosen" MinDate="_minDate" PickerVariant="PickerVariant.Static"/>
                        <MudHidden Breakpoint="@Breakpoint.Xs">
                        </MudHidden>
                        <MudButton Disabled="@_processing1" OnClick="ProcessSomething" @bind-Completed="_step1Complete" Variant="Variant.Outlined" Color="Color.Primary">
                            @if (_processing1)
                            {
                                <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true" />
                                <MudText Class="ms-2">Processing</MudText>
                            }
                            else
                            {
                                <MudText>Confirm Date</MudText>
                            }
                        </MudButton>
                    </MudCardContent>
                </MudCard>
            </MudStep>

            <MudStep Title="Step 2" SecondaryText="Whos coming?" HasError="@(_step2Complete==false)">
                <MudDataGrid Items="@admissiontickets" Filterable="false" SortMode="@SortMode.None" Groupable="false">
                    <Columns>
                        <PropertyColumn Property = "x => x.tickets" Title="Admission Tickets"/>
                        <PropertyColumn Property = "x => x.prices" Title="Prices" />
                        <PropertyColumn Property = "x => x.quantity" Title="Quantity" />
                    </Columns>
                </MudDataGrid>
            </MudStep>

            <MudStep Title="Step 3" SecondaryText="Choose a timeslot" HasError="@(_step3Complete==false)">
                @* <MudTextField Label="Enter some text" @bind-Value="_step2TextInput" Variant="Variant.Filled" Clearable /> *@
            </MudStep>

        </MudStepper>
    </MudCard>
</MudContainer>






@code 
{

    //Admission Ticket list
    public record admissionticketlist(string tickets, float prices, int quantity);
    public IEnumerable<admissionticketlist> admissiontickets;
    protected override void OnInitialized()
    {
        admissiontickets = new List<admissionticketlist>
        {
            new admissionticketlist("Standard Adult", 19.99 ,0),
        };
    }




    [Inject]
    IDialogService DialogService { get; set; }

    //DataSubmitForm ticketdate = new DataSubmitForm();
    bool success;

    private bool? _step1Complete;
    private bool? _step2Complete;
    private bool? _step3Complete;
    //private string _step2TextInput;
    private DateTime? _date;
    private DateTime? _datechosen = DateTime.Today;
    private DateTime _minDate = DateTime.Now.Date;

    //Date button processing
    private bool _processing1 = false;
    private async Task ProcessSomething()
    {
        _processing1 = true;
        _date = _datechosen;
        _step1Complete = true;
        await Task.Delay(2000);
        _processing1 = false;
    }

    private async Task OnPreviewInteraction(StepperInteractionEventArgs arg)
    {
        if (arg.Action == StepAction.Complete)
        {
            // occurrs when clicking next
            await ControlStepCompletion(arg);
        }
        else if (arg.Action == StepAction.Activate)
        {
            // occurrs when clicking a step header with the mouse
            await ControlStepNavigation(arg);
        }
    }

    private async Task ControlStepCompletion(StepperInteractionEventArgs arg)
    {
        switch (arg.StepIndex)
        {
            case 0:
                if ((_step1Complete != true) || (_date < _minDate) || (_date == null))
                {
                    await DialogService.ShowMessageBox("Error", "You have not selected a date in the step 'Date'.");
                    arg.Cancel = true;
                }
                break;
            case 1:
                if ((_step2Complete != true))
                {
                    await DialogService.ShowMessageBox("Error", "You have not...");
                    arg.Cancel = true;
                }
                break;
        }
    }

    private async Task ControlStepNavigation(StepperInteractionEventArgs arg)
    {
        switch (arg.StepIndex)
        {
            case 1:
                if (_step1Complete != true)
                {
                    await DialogService.ShowMessageBox("Error", "Finish step 'Date' first.");
                    arg.Cancel = true;
                }
                break;
            case 2:
                if ((_step1Complete != true) || (_step2Complete != true))
                {
                    await DialogService.ShowMessageBox("Error", "Finish step 1 and 2 first.");
                    arg.Cancel = true;
                }
                break;
        }
    }
    private void DataSubmit(EditContext context)
    {
        success = true;
    }
    public class DataSubmitForm
    {

    }














}
